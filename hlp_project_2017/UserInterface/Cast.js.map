{"version":3,"sources":["..\\Cast.fs"],"names":[],"mappings":"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","file":"Cast.js","sourcesContent":["ï»¿namespace ARM7TDMI\r\n\r\nmodule Cast=\r\n    open InstructionType\r\n    open MachineState\r\n\r\n    /// matches string (X -> X) returning integer\r\n    let (|IsInt|_|) (s:string) = \r\n        try \r\n            int s |> Some\r\n        with _ -> None\r\n\r\n    ///matches string (#X->X) returning integer\r\n    let (|IsLit|_|) (s:string) = \r\n        let getX = s.[1..] \r\n        if s.[0]='#'\r\n        then\r\n            match getX with\r\n            | IsInt x -> Some(x)\r\n            | _ -> None\r\n        else\r\n            None\r\n\r\n    /// matches string returning register\r\n    let (|IsReg|_|) (s:string) =\r\n        let getX = s.[1..] \r\n        //let ParseToReg =\r\n        if s.[0]='R'\r\n        then\r\n            match getX with\r\n            | IsInt x when x<=15 -> R(x) |> Some\r\n            | _ -> None\r\n            //| \"R0\" -> R 0\r\n            //| \"R1\" -> R 1\r\n        else\r\n            None//invalidOp \"register does not exist\"\r\n\r\n    /// matches string list returning register list\r\n    let rec (|IsRegList|_|) (lst:string list) = \r\n        match lst with\r\n        | IsReg reg::IsRegList rest -> reg::rest |> Some\r\n        | [IsReg reg] -> [reg] |> Some\r\n        | [] -> [] |> Some\r\n        | _ -> None\r\n\r\n    /// matches RegOrLit string returning the RegOrLit\r\n    let (|IsRegOrLit|_|) =\r\n        function\r\n        | IsReg reg -> Reg(reg) |> Some\r\n        | IsLit lit -> Lit(lit) |> Some\r\n        | _ -> None\r\n\r\n     /// matches string returning string\r\n    let (|IsLabel|_|) = \r\n        function\r\n        | IsReg x -> None\r\n        | s -> \r\n            try \r\n                string s |> Some \r\n            with _ -> None\r\n\r\n    ///matches Addr label or addr literal\r\n    let (|IsAddr|_|) (b_map:Map<string,Address>) (s:string) = \r\n        let getX = s.[1..] \r\n        if s.[0]='#'\r\n        then\r\n            match getX with\r\n            | IsInt x -> Some(Addr(x))\r\n            | _ -> None\r\n        else\r\n            b_map.TryFind(s)\r\n\r\n    //cast value to addr\r\n    let ValueToAddr (value:Value) =\r\n        match value with\r\n        | (x:int) -> Addr x\r\n    //cast value opttion to addr\r\n    let ValueOptToAddr (value:Option<Value>) =\r\n        match value with\r\n        | Some (x:int) -> Addr x\r\n        | None -> failwith \"R 15 has not been initialized or has been removed\"\r\n    //cast addr to value\r\n    let AddrToValue (addr:Address) =\r\n        match addr with\r\n        | Addr (x:int) -> (x:Value)\r\n\r\n    //check if one branch label returns bool for filter\r\n    let IsBranch =\r\n        function\r\n        | [IsLabel x] -> true\r\n        | _ -> false\r\n    //check if one branch label returns bool for filter\r\n    let IsNotBranch =\r\n        function\r\n        | [IsLabel x] -> false\r\n        | _ -> true\r\n\r\n    //check if instruction is valid\r\n    \r\n    //MOV and MVN\r\n    let (|IsMOVInst|_|)=\r\n        function\r\n        | \"MOV\" -> MOV |> Some\r\n        | \"MVN\" -> MVN |> Some\r\n        | _ -> None\r\n\r\n    //ALU\r\n    let (|IsALUInst|_|) =\r\n        function\r\n        | \"ADD\" -> ADD |> Some\r\n        | \"ADC\" -> ADC |> Some\r\n        | \"SUB\" -> SUB |> Some\r\n        | \"SBC\" -> SBC |> Some\r\n        | \"RSB\" -> RSB |> Some\r\n        | \"RSC\" -> RSC |> Some\r\n        //| \"AND\" -> AND |> Some\r\n        | \"EOR\" -> EOR |> Some\r\n        | \"BIC\" -> BIC |> Some\r\n        | \"ORR\" -> ORR |> Some\r\n        | _ -> None\r\n       \r\n    //Shift\r\n    let (|IsShiftInst|_|) =\r\n        function\r\n        | \"LSL\" -> LSL |> Some\r\n        | \"LSR\" -> LSR |> Some\r\n        | \"ASR\" -> ASR |> Some\r\n        | \"ROR\" -> ROR |> Some\r\n        | _ -> None\r\n    \r\n    //RRX has its own pattern matching\r\n\r\n    //compare\r\n    let (|IsCOMPInst|_|) =\r\n        function\r\n        | \"CMP\" -> CMP |> Some\r\n        | \"CMN\" -> CMN |> Some\r\n        | \"TST\" -> TST |> Some\r\n        | \"TEQ\" -> TEQ |> Some\r\n        | _ -> None\r\n\r\n    //ADR and LDR pseudo has their own pattern matching\r\n    //Memory\r\n    let (|IsMEMRInst|_|) =\r\n        function\r\n        | \"LDR\" -> LDR |> Some\r\n        | \"STR\" -> STR |> Some\r\n        | _ -> None\r\n\r\n    let (|IsMEMMInst|_|) =\r\n        function\r\n        | \"LDM\" -> LDM |> Some\r\n        | \"STM\" -> STM |> Some\r\n        | _ -> None\r\n\r\n    let (|IsBranchInst|_|) =\r\n        function\r\n        | \"BL\" -> BL |> Some\r\n        | \"B\" -> B |> Some\r\n        | _ -> None\r\n\r\n    let (|IsSetFlag|_|) =\r\n        function\r\n        | \"S\" -> true |> Some\r\n        | \"\" -> false |> Some\r\n        | _ -> None\r\n\r\n    let (|IsByteMode|_|) =\r\n        function\r\n        | \"B\" -> true |> Some\r\n        | \"\" -> false |> Some\r\n        | _ -> None\r\n\r\n    let (|IsCondition|_|) =\r\n        function\r\n        | \"EQ\" -> EQ |> Some\r\n        | \"NE\" -> NE |> Some \r\n        | \"CS\" -> CS |> Some \r\n        | \"HS\" -> HS |> Some \r\n        | \"CC\" -> CC |> Some \r\n        | \"LO\" -> LO |> Some \r\n        | \"MI\" -> MI |> Some \r\n        | \"PL\" -> PL |> Some \r\n        | \"VS\" -> VS |> Some \r\n        | \"VC\" -> VC |> Some \r\n        | \"HI\" -> HI |> Some \r\n        | \"LS\" -> LS |> Some \r\n        | \"GE\" -> GE |> Some \r\n        | \"LT\" -> LT |> Some \r\n        | \"GT\" -> GT |> Some \r\n        | \"LE\" -> LE |> Some \r\n        | \"AL\" -> AL |> Some \r\n        | \"\" -> NoCond |> Some\r\n        | _ -> None\r\n\r\n        //LDMdir\r\n    let (|IsLDMdir|_|) = \r\n        function\r\n        | \"ED\" -> ED |> Some\r\n        | \"IB\" -> IB |> Some\r\n        | \"FD\" -> FD |> Some\r\n        | \"IA\" -> IA |> Some\r\n        | \"EA\" -> EA |> Some\r\n        | \"DB\" -> DB |> Some\r\n        | \"FA\" -> FA |> Some\r\n        | \"DA\" -> DA |> Some\r\n        | _ -> None \r\n    //because of fable we have to do this\r\n    let CondCast =\r\n        function\r\n        | NoCond -> None\r\n        | cond -> cond |> Some\r\n    //No forget DCD, EQU, FILL and END\r\n\r\n    let (|Prefix|_|) (p:string) (s:string) =\r\n        if s.StartsWith(p) then\r\n            Some(s.Substring(p.Length))\r\n        else\r\n            None\r\n\r\n    let checkS_or_B (s:string) =\r\n        if s <> \"\"\r\n        then \r\n            if s.[0] ='S'\r\n            then \"S\"\r\n            elif s.[0] ='B'\r\n            then \"B\"\r\n            else \"\"\r\n        else \"\"\r\n    let checkCond (s:string) =\r\n        if s.Length = 2\r\n        then s\r\n        elif s.Length = 3\r\n        then s.[1..2]\r\n        elif s = \"S\"\r\n        then \"\"\r\n        elif s = \"B\"\r\n        then \"\"\r\n        else s\r\n\r\n    let toTuple (inst:string) (rest:string) = [inst; checkS_or_B rest; checkCond rest]\r\n\r\n    let TokenizeInst (s:string)=\r\n        match s with\r\n        | Prefix \"MOV\" rest -> toTuple \"MOV\" rest   //1\r\n        | Prefix \"MVN\" rest -> toTuple \"MVN\" rest   //2\r\n        | Prefix \"ADD\" rest -> toTuple \"ADD\" rest   //3\r\n        | Prefix \"ADC\" rest -> toTuple \"ADC\" rest   //4\r\n        | Prefix \"SUB\" rest -> toTuple \"SUB\" rest   //5\r\n        | Prefix \"SBC\" rest -> toTuple \"SBC\" rest   //6\r\n        | Prefix \"RSB\" rest -> toTuple \"RSB\" rest   //7\r\n        | Prefix \"RSC\" rest -> toTuple \"RSC\" rest   //8\r\n        | Prefix \"AND\" rest -> toTuple \"AND\" rest   //9\r\n        | Prefix \"EOR\" rest -> toTuple \"EOR\" rest   //10\r\n        | Prefix \"BIC\" rest -> toTuple \"BIC\" rest   //11\r\n        | Prefix \"ORR\" rest -> toTuple \"ORR\" rest   //12\r\n        | Prefix \"LSL\" rest -> toTuple \"LSL\" rest   //13\r\n        | Prefix \"LSR\" rest -> toTuple \"LSR\" rest   //14\r\n        | Prefix \"ASR\" rest -> toTuple \"ASR\" rest   //15\r\n        | Prefix \"ROR\" rest -> toTuple \"ROR\" rest   //16\r\n        | Prefix \"RRX\" rest -> toTuple \"ROR\" rest   //17\r\n        | Prefix \"CMP\" rest -> toTuple \"CMP\" rest   //18\r\n        | Prefix \"CMN\" rest -> toTuple \"CMN\" rest   //19\r\n        | Prefix \"TST\" rest -> toTuple \"TST\" rest   //20\r\n        | Prefix \"TEQ\" rest -> toTuple \"TEQ\" rest   //21\r\n        | Prefix \"BL\" rest -> toTuple \"BL\" rest     //22\r\n        | Prefix \"B\" rest -> toTuple \"B\" rest       //23\r\n        | Prefix \"ADR\" rest -> toTuple \"ADR\" rest   //24\r\n        | Prefix \"LDR\" rest -> toTuple \"LDR\" rest   //25 - double\r\n        | Prefix \"STR\" rest -> toTuple \"STR\" rest   //26\r\n        | Prefix \"LDM\" rest -> toTuple \"LDM\" rest   //27\r\n        | Prefix \"STM\" rest -> toTuple \"STM\" rest   //28\r\n        | x -> [x; \"\"; \"\"]\r\n   "]}